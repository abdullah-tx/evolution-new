function h(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function w(t,c){let i=c.split(" ").reduce((n,u)=>{let[a,...d]=u.split(":"),s=d.join(":");return n[a]||(n[a]=[]),n[a].push(s),n},{}),r=h(t);return Object.entries(i).every(([n,u])=>u.some(a=>a.split(",").every(s=>{let g=h(s);switch(n.toLowerCase()){case"contains":return r.includes(g);case"notcontains":return!r.includes(g);case"startswith":return r.startsWith(g);case"endswith":return r.endsWith(g);case"exact":return r===g;default:return!1}})))}var b=async(t,c,i,r)=>{let n=await t.findFirst({where:{enabled:!0,triggerType:"all",instanceId:r}});if(n)return n;let u=await t.findMany({where:{enabled:!0,triggerType:"advanced",instanceId:r}});for(let e of u)if(w(i,e.triggerValue))return e;let a=await t.findFirst({where:{enabled:!0,triggerType:"keyword",triggerOperator:"equals",triggerValue:i,instanceId:r}});if(a)return a;let d=await t.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"regex",instanceId:r}}),s=null;for(let e of d)if(new RegExp(e.triggerValue).test(i)){s=e;break}if(s)return s;let g=await t.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"startsWith",instanceId:r}}),l=null;for(let e of g)if(i.startsWith(e.triggerValue)){l=e;break}if(l)return l;let p=await t.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"endsWith",instanceId:r}}),o=null;for(let e of p)if(i.endsWith(e.triggerValue)){o=e;break}if(o)return o;let y=await t.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"contains",instanceId:r}}),f=null;for(let e of y)if(i.includes(e.triggerValue)){f=e;break}return f||null};export{b as findBotByTrigger};
//# sourceMappingURL=findBotByTrigger.mjs.map