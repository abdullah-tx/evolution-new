var h=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var x=(e,a)=>{for(var i in a)h(e,i,{get:a[i],enumerable:!0})},k=(e,a,i,r)=>{if(a&&typeof a=="object"||typeof a=="function")for(let t of V(a))!b.call(e,t)&&t!==i&&h(e,t,{get:()=>a[t],enumerable:!(r=W(a,t))||r.enumerable});return e};var v=e=>k(h({},"__esModule",{value:!0}),e);var O={};x(O,{findBotByTrigger:()=>m});module.exports=v(O);function w(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function p(e,a){let i=a.split(" ").reduce((t,d)=>{let[s,...l]=d.split(":"),g=l.join(":");return t[s]||(t[s]=[]),t[s].push(g),t},{}),r=w(e);return Object.entries(i).every(([t,d])=>d.some(s=>s.split(",").every(g=>{let u=w(g);switch(t.toLowerCase()){case"contains":return r.includes(u);case"notcontains":return!r.includes(u);case"startswith":return r.startsWith(u);case"endswith":return r.endsWith(u);case"exact":return r===u;default:return!1}})))}var m=async(e,a,i,r)=>{let t=await e.findFirst({where:{enabled:!0,triggerType:"all",instanceId:r}});if(t)return t;let d=await e.findMany({where:{enabled:!0,triggerType:"advanced",instanceId:r}});for(let n of d)if(p(i,n.triggerValue))return n;let s=await e.findFirst({where:{enabled:!0,triggerType:"keyword",triggerOperator:"equals",triggerValue:i,instanceId:r}});if(s)return s;let l=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"regex",instanceId:r}}),g=null;for(let n of l)if(new RegExp(n.triggerValue).test(i)){g=n;break}if(g)return g;let u=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"startsWith",instanceId:r}}),o=null;for(let n of u)if(i.startsWith(n.triggerValue)){o=n;break}if(o)return o;let y=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"endsWith",instanceId:r}}),f=null;for(let n of y)if(i.endsWith(n.triggerValue)){f=n;break}if(f)return f;let T=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"contains",instanceId:r}}),c=null;for(let n of T)if(i.includes(n.triggerValue)){c=n;break}return c||null};0&&(module.exports={findBotByTrigger});
//# sourceMappingURL=findBotByTrigger.js.map